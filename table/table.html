<!DOCTYPE html>
<html>

<head>
	<meta charset="UTF-8">
	<link href="http://cdn.bootcss.com/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet">
	<script src="http://cdn.bootcss.com/angular.js/1.4.5/angular.min.js"></script>
	<title>è¡¨æ ¼ç›¸å…³</title>
</head>

<body ng-app="demo">

	<h3>è¡¨æ ¼çš„åŸºæœ¬æ“ä½œ</h3>

	<div ng-controller="CartCtrl">
		<button class="btn btn-default" ng-click="append()">æ·»åŠ åˆ°æœ€å</button>
		<button class="btn btn-default" ng-click="prepend()">åŠ åˆ°å‰é¢</button>
		<button class="btn btn-default" ng-click="sort()">æ’åº</button>

		<table class="table table-bordered">
			<thead>
				<tr>
					<th>åç§°</th>
					<th>ä»·æ ¼</th>
					<th>è´­ä¹°æ•°é‡</th>
					<th>å•å“ä»·æ ¼</th>
					<th></th>
				</tr>
			</thead>
			<tbody>
				<tr ng-repeat="item in goods">
					<td>{{item.name}}</td>
					<td>{{item.price}}</td>
					<td>{{item.count}}</td>
					<td>{{item.count * item.price}}å…ƒ</td>
					<td>
						<button class="btn btn-sm btn-warning" ng-click="remove(item)">åˆ é™¤</button>
					</td>
				</tr>
			</tbody>
		</table>
	</div>

	<hr/>

	<h3>å¤æ‚ä¸€äº›çš„è¡¨æ ¼</h3>

	<div ng-controller="CartCtrl">
		<button class="btn btn-default" ng-click="append()">æ·»åŠ åˆ°æœ€å</button>
		<button class="btn btn-default" ng-click="prepend()">åŠ åˆ°å‰é¢</button>
		<button class="btn btn-default" ng-click="sort()">æ’åº</button>

		<table class="table table-bordered">
			<thead>
				<tr>
					<th>åç§°</th>
					<th>ä»·æ ¼</th>
					<th>è´­ä¹°æ•°é‡</th>
					<th>å•å“ä»·æ ¼</th>
					<th></th>
				</tr>
			</thead>
			<tbody>
				<tr ng-repeat-start="item in goods">
					<td>
						<button class="btn btn-xs btn-default" ng-click="item.$expand=!item.$expand" ng-class="{'dropdown-toggle':!item.$expand, 'dropup':item.$expand}">
							<span class="caret"></span>
						</button>
						{{item.name}}
					</td>
					<td>{{item.price}}</td>
					<td>
						{{item.count}}
						<button class="btn btn-xs btn-info" ng-click="increase(item)">å¢åŠ </button>
						<button class="btn btn-xs btn-info" ng-click="decrease(item)">å‡å°‘</button>
					</td>
					<td>{{item.count * item.price}}å…ƒ</td>
					<td>
						<button class="btn btn-sm btn-warning" ng-click="remove(item)">åˆ é™¤</button>
					</td>
				</tr>
				<tr ng-repeat-end ng-show="item.$expand">
					<td colspan="5">{{item.description}}</td>
				</tr>
			</tbody>
			<tfoot>
				<tr>
					<td colspan="5">
						æ€»ä»·ä¸º{{total()}}å…ƒ
					</td>
				</tr>
			</tfoot>
		</table>
	</div>

	<hr/>

	<h3>åŒ…å«é€‰ä¸­åŠŸèƒ½çš„è¡¨æ ¼</h3>

	<div ng-controller="CartCtrl">
		<button class="btn btn-default" ng-click="append()">æ·»åŠ åˆ°æœ€å</button>
		<button class="btn btn-default" ng-click="sort()">æ’åº</button>

		<button class="btn btn-default" ng-disabled="!someChecked()">æ”¯ä»˜</button>

		<table class="table table-bordered">
			<thead>
				<tr>
					<th>
						<input type="checkbox" ng-model="$allChecked" ng-change="checkAll()" />
					</th>
					<th>åç§°</th>
					<th>ä»·æ ¼</th>
					<th>è´­ä¹°æ•°é‡</th>
					<th>å•å“ä»·æ ¼</th>
					<th></th>
				</tr>
			</thead>
			<tbody>
				<tr ng-repeat="item in goods">
					<th>
						<input type="checkbox" ng-model="item.$checked" ng-change="checkItem(item)" />
					</th>
					<td>
						{{item.name}}
					</td>
					<td>{{item.price}}</td>
					<td>
						{{item.count}}
						<button class="btn btn-xs btn-info" ng-click="increase(item)">å¢åŠ </button>
						<button class="btn btn-xs btn-info" ng-click="decrease(item)">å‡å°‘</button>
					</td>
					<td>{{item.count * item.price}}å…ƒ</td>
					<td>
						<button class="btn btn-sm btn-warning" ng-click="remove(item)">åˆ é™¤</button>
					</td>
				</tr>
			</tbody>
			<tfoot>
				<tr>
					<td colspan="6">
						æ€»ä»·ä¸º{{total()}}å…ƒï¼Œé€‰ä¸­çš„å•†å“æ€»ä»·ä¸º{{totalToPay()}}å…ƒ
					</td>
				</tr>
			</tfoot>
		</table>
	</div>

	<hr/>

	<h3>åŠ¨æ€ç¼–è¾‘</h3>

	<div ng-controller="CartCtrl">
		<button class="btn btn-default" ng-click="append()">æ·»åŠ åˆ°æœ€å</button>

		<table class="table table-bordered">
			<thead>
				<tr>
					<th>åç§°</th>
					<th>ä»·æ ¼</th>
					<th>è´­ä¹°æ•°é‡</th>
					<th>å•å“ä»·æ ¼</th>
					<th></th>
				</tr>
			</thead>
			<tbody>
				<tr ng-repeat="item in goods">
					<td>
						<span ng-if="!item.$editing">{{item.name}}</span>
						<input ng-model="item.name" ng-if="item.$editing" />
					</td>
					<td>{{item.price}}</td>
					<td>{{item.count}}</td>
					<td>{{item.count * item.price}}å…ƒ</td>
					<td>
						<button class="btn btn-sm btn-warning" ng-if="!item.$editing" ng-click="item.$editing=true">ä¿®æ”¹</button>
						<button class="btn btn-sm btn-primary" ng-if="item.$editing" ng-click="item.$editing=false">ä¿å­˜</button>
						<button class="btn btn-sm btn-warning" ng-click="remove(item)">åˆ é™¤</button>
					</td>
				</tr>
			</tbody>
		</table>
	</div>


	<script>
		angular.module("demo", [])
			.controller("CartCtrl", ["$scope", function ($scope) {
				$scope.goods = [
					{name: "è‹¹æœğŸ", price: 5, count: 1, description: "äºšå½“å’Œå¤å¨ƒ"},
					{name: "æ©™å­ğŸŠ", price: 3, count: 2, description: "å¯Œå«ç»´ç”Ÿç´ C"},
					{name: "é¦™è•‰ğŸŒ", price: 4, count: 1, description: "çŒ´å­æœ€çˆ±"}
				];

				$scope.append = function () {
					$scope.goods.push({
						name: "å°ç‹—ğŸ¶" + $scope.goods.length,
						price: 5+Math.ceil(Math.random()*20),
						count: 1, 
						description: "äººç±»çš„å¥½æœ‹å‹"
					});
				};

				$scope.prepend = function () {
					$scope.goods.unshift({
						name: "ğŸŒ²" + $scope.goods.length,
						price: 10+Math.ceil(Math.random()*10),
						count: 2, 
						description: "é“ƒå„¿å“å®å½“"
					});
				};

				$scope.sort = function () {
					$scope.goods.sort(function (a, b) {
						return a.price - b.price;
					});
				};

				$scope.increase = function (item) {
					item.count++;
				};

				$scope.decrease = function (item) {
					if (item.count > 0) {
						item.count--;
					}
				};

				$scope.remove = function (item) {
					return $scope.goods = $scope.goods.filter(function (it) {
						return it != item;
					});
				};
				
				$scope.checkAll = function() {
					$scope.goods.forEach(function (it) {
						it.$checked = $scope.$allChecked;
					});
				};
				
				$scope.checkItem = function(item) {
					$scope.$allChecked = $scope.goods.every(function(it) {
						return it.$checked;
					});
				};
				
				$scope.$watchCollection("goods", function(val) {
					$scope.$allChecked = $scope.goods.every(function(it) {
						return it.$checked;
					});
				});
				
				$scope.someChecked = function() {
					return $scope.goods.some(function(it) {
						return it.$checked;
					});
				};

				$scope.total = function () {
					return $scope.goods.reduce(function(prev, next) {
						return prev + next.count * next.price;
					}, 0);
				};
				
				$scope.totalToPay = function () {
					return $scope.goods.reduce(function(prev, next) {
						return next.$checked ? prev + next.count * next.price : prev;
					}, 0);
				};
			}]);
	</script>

</body>

</html>