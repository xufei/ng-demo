<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<link href="//cdn.bootcss.com/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet">
	<script src="//cdn.bootcss.com/angular.js/1.4.5/angular.min.js"></script>
	<title>è¡¨æ ¼ç›¸å…³</title>
</head>
<body ng-app="demo">

<h3>è¡¨æ ¼çš„åŸºæœ¬æ“ä½œ</h3>

<div ng-controller="CartCtrl as cartCtrl">
	<button ng-click="cartCtrl.append()">æ·»åŠ åˆ°æœ€å</button>
	<button ng-click="cartCtrl.prepend()">åŠ åˆ°å‰é¢</button>
	<button ng-click="cartCtrl.sort()">æ’åº</button>

	<table class="table table-bordered">
		<thead>
		<tr>
			<th>åç§°</th>
			<th>ä»·æ ¼</th>
			<th>è´­ä¹°æ•°é‡</th>
			<th>å•å“ä»·æ ¼</th>
			<th></th>
		</tr>
		</thead>
		<tbody>
		<tr ng-repeat="item in cartCtrl.goods">
			<td>{{item.name}}</td>
			<td>{{item.price}}</td>
			<td>{{item.count}}</td>
			<td>{{item.count * item.price}}å…ƒ</td>
			<td>
				<button class="btn btn-sm btn-warning" ng-click="cartCtrl.remove(item)">åˆ é™¤</button>
			</td>
		</tr>
		</tbody>
	</table>
</div>

<hr/>

<h3>å¤æ‚ä¸€äº›çš„è¡¨æ ¼</h3>

<div ng-controller="CartCtrl as cartCtrl">
	<button ng-click="cartCtrl.append()">æ·»åŠ åˆ°æœ€å</button>
	<button ng-click="cartCtrl.prepend()">åŠ åˆ°å‰é¢</button>
	<button ng-click="cartCtrl.sort()">æ’åº</button>

	<table class="table table-bordered">
		<thead>
		<tr>
			<th>åç§°</th>
			<th>ä»·æ ¼</th>
			<th>è´­ä¹°æ•°é‡</th>
			<th>å•å“ä»·æ ¼</th>
			<th></th>
		</tr>
		</thead>
		<tbody>
		<tr ng-repeat-start="item in cartCtrl.goods">
			<td>
				<button class="btn btn-xs btn-default"
				        ng-click="item.$expand=!item.$expand"
				        ng-class="{'dropdown-toggle':!item.$expand, 'dropup':item.$expand}">
					<span class="caret"></span>
				</button>
				{{item.name}}
			</td>
			<td>{{item.price}}</td>
			<td>
				{{item.count}}
				<button class="btn btn-xs btn-info" ng-click="cartCtrl.increase(item)">å¢åŠ </button>
				<button class="btn btn-xs btn-info" ng-click="cartCtrl.decrease(item)">å‡å°‘</button>
			</td>
			<td>{{item.count * item.price}}å…ƒ</td>
			<td>
				<button class="btn btn-sm btn-warning" ng-click="cartCtrl.remove(item)">åˆ é™¤</button>
			</td>
		</tr>
		<tr ng-repeat-end ng-show="item.$expand">
			<td colspan="5">{{item.description}}</td>
		</tr>
		</tbody>
		<tfoot>
			æ€»ä»·ä¸º{{cartCtrl.total()}}å…ƒ
		</tfoot>
	</table>
</div>


<script>
	angular.module("demo", [])
			.controller("CartCtrl", [function () {
				this.goods = [
					{name: "è‹¹æœğŸ", price: 5, count: 1, description: "äºšå½“å’Œå¤å¨ƒ"},
					{name: "æ©™å­ğŸŠ", price: 3, count: 2, description: "å¯Œå«ç»´ç”Ÿç´ C"}
				];

				this.append = function () {
					this.goods.push({
						name: "å°ç‹—ğŸ¶" + this.goods.length,
						price: 5+Math.ceil(Math.random()*20),
						count: 1, 
						description: "äººç±»çš„å¥½æœ‹å‹"
					});
				};

				this.prepend = function () {
					this.goods.unshift({
						name: "ğŸŒ²" + this.goods.length,
						price: 10+Math.ceil(Math.random()*10),
						count: 2, 
						description: "é“ƒå„¿å“å®å½“"
					});
				};

				this.sort = function () {
					this.goods.sort(function (a, b) {
						return a.price - b.price;
					});
				};

				this.increase = function (item) {
					item.count++;
				};

				this.decrease = function (item) {
					if (item > 0) {
						item.count--;
					}
				};

				this.remove = function (item) {
					return this.goods = this.goods.filter(function (it) {
						return it != item;
					});
				};

				this.total = function () {
					var total = 0;
					this.goods.forEach(function (it) {
						total += it.count * it.price;
					});

					return total;
				};
			}]);
</script>

</body>
</html>